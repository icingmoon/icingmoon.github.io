/* start custom scss snippet */
.article__content {
  details {
    margin: map-get($spacers, 2) 0;

    summary {
      &.success {
        padding: map-get($spacers, 2) map-get($spacers, 3);
        background-color: rgba($green, .1);
        border: 1px solid $green;
        border-radius: map-get($base, border-radius);
      }

      &.info {
        padding: map-get($spacers, 2) map-get($spacers, 3);
        background-color: rgba($blue, .1);
        border: 1px solid $blue;
        border-radius: map-get($base, border-radius);
      }

      &.warning {
        padding: map-get($spacers, 2) map-get($spacers, 3);
        background-color: rgba($yellow, .1);
        border: 1px solid $yellow;
        border-radius: map-get($base, border-radius);
      }

      &.error {
        padding: map-get($spacers, 2) map-get($spacers, 3);
        background-color: rgba($red, .1);
        border: 1px solid $red;
        border-radius: map-get($base, border-radius);
      }
    }

    &.error {
      border: 1px solid $red;
      border-radius: map-get($base, border-radius);

      summary {
        background-color: rgba($red, .1);
        padding: map-get($spacers, 2) map-get($spacers, 3);
      }
    }

    &.warning {
      border: 1px solid $yellow;
      border-radius: map-get($base, border-radius);

      summary {
        background-color: rgba($yellow, .1);
        padding: map-get($spacers, 2) map-get($spacers, 3);
      }
    }

    &.info {
      border: 1px solid $blue;
      border-radius: map-get($base, border-radius);

      summary {
        background-color: rgba($blue, .1);
        padding: map-get($spacers, 2) map-get($spacers, 3);
      }
    }

    &.success {
      border: 1px solid $green;
      border-radius: map-get($base, border-radius);

      summary {
        background-color: rgba($green, .1);
        padding: map-get($spacers, 2) map-get($spacers, 3);
      }
    }

    &.exploit {
      border: 1px solid $blue;
      border-radius: map-get($base, border-radius);

      summary {
        background-color: rgba($blue, .1);
        padding: map-get($spacers, 2) map-get($spacers, 3);
      }
    }

    @mixin details-variant($en-title, $zh-title, $color) {
      border: 1px solid $color;
      border-left: 4px solid $color;
      border-radius: map-get($base, border-radius);
      background-color: rgba($color, .1);
      padding: 0 map-get($spacers, 3);

      summary {
        margin: 0 -#{map-get($spacers, 3)};
        padding: map-get($spacers, 2) map-get($spacers, 3);
        padding-left: 2rem; // 增加左内边距以容纳图标
        font-weight: map-get($base, font-weight-bold);
        cursor: pointer;
        position: relative;
        list-style: none; // 隐藏默认标记

        &::-webkit-details-marker {
          display: none;
        }

        // 图标
        &::before {
          content: "\f101"; // fa-angle-double-right
          font-family: "Font Awesome 5 Free";
          font-weight: 900;
          font-size: 1.1em;
          color: $color; // 图标颜色与 block 颜色一致
          position: absolute;
          left: map-get($spacers, 2);
          top: 50%;
          transform: translateY(-50%);
          transition: transform .2s;
          width: 1em;
          text-align: center;
        }

        // 标题
        &::after {
          content: $en-title;
        }

        &[data-title]::after {
          content: $en-title " (" attr(data-title) ")";
        }
      }

      &[open] {
        padding-bottom: map-get($spacers, 2);

        summary::before {
          transform: translateY(-50%) rotate(90deg);
        }
      }

      // 中文标题适配
      &:lang(zh) summary::after {
        content: $zh-title;
      }

      &:lang(zh) summary[data-title]::after {
        content: $zh-title " (" attr(data-title) ")";
      }
    }

    &.proof { @include details-variant("Proof", "证明", $yellow); }
    &.note { @include details-variant("Note", "注意", $blue); }
    &.remark { @include details-variant("Remark", "注记", $green); }
    &.theorem { @include details-variant("Theorem", "定理", $red); }
    &.proposition { @include details-variant("Proposition", "命题", $blue); }
    &.lemma { @include details-variant("Lemma", "引理", $blue); }
    &.definition { @include details-variant("Definition", "定义", $blue); }
    &.example { @include details-variant("Example", "示例", $green); }
    &.solution { @include details-variant("Solution", "解答", $yellow); }

    @mixin details-plain-variant($color) {
      border: 1px solid $color;
      border-left: 4px solid $color;
      border-radius: map-get($base, border-radius);
      background-color: rgba($color, .05);
      padding: 0 map-get($spacers, 3);

      summary {
        margin: 0 -#{map-get($spacers, 3)};
        padding: map-get($spacers, 2) map-get($spacers, 3);
        padding-left: 2rem;
        font-weight: map-get($base, font-weight-bold);
        cursor: pointer;
        position: relative;
        list-style: none;

        &::-webkit-details-marker {
          display: none;
        }

        &::before {
          content: "\f101";
          font-family: "Font Awesome 5 Free";
          font-weight: 900;
          font-size: 1.1em;
          color: $color;
          position: absolute;
          left: map-get($spacers, 2);
          top: 50%;
          transform: translateY(-50%);
          transition: transform .2s;
          width: 1em;
          text-align: center;
        }

        &::after {
          content: attr(data-title);
        }
      }

      &[open] {
        padding-bottom: map-get($spacers, 2);

        summary::before {
          transform: translateY(-50%) rotate(90deg);
        }
      }
    }

    &.plain {
      &.success { @include details-plain-variant($green); }
      &.info { @include details-plain-variant($blue); }
      &.warning { @include details-plain-variant($yellow); }
      &.error { @include details-plain-variant($red); }
      // Default fallback
      &:not(.success):not(.info):not(.warning):not(.error) { @include details-plain-variant($text-color); }
    }

    @mixin details-code-variant($color) {
      border: 1px solid $color;
      border-left: 4px solid $color;
      border-radius: map-get($base, border-radius);
      background-color: rgba($color, .1);
      padding: 0 map-get($spacers, 3);

      summary {
        margin: 0 -#{map-get($spacers, 3)};
        padding: map-get($spacers, 2) map-get($spacers, 3);
        padding-left: 2rem;
        font-weight: map-get($base, font-weight-bold);
        cursor: pointer;
        position: relative;
        list-style: none;

        &::-webkit-details-marker {
          display: none;
        }

        &::before {
          content: "\f101";
          font-family: "Font Awesome 5 Free";
          font-weight: 900;
          font-size: 1.1em;
          color: $color;
          position: absolute;
          left: map-get($spacers, 2);
          top: 50%;
          transform: translateY(-50%);
          transition: transform .2s;
          width: 1em;
          text-align: center;
        }

        // 默认不显示标题
        &::after {
          content: "Code"; // 默认标题，如果没有 data-title
        }

        &[data-title]::after {
          content: attr(data-title);
        }
      }

      &[open] {
        padding-bottom: map-get($spacers, 2);

        summary::before {
          transform: translateY(-50%) rotate(90deg);
        }
      }
      
      // 移除中文特定前缀
      &:lang(zh) summary::after {
        content: "代码";
      }
      
      &:lang(zh) summary[data-title]::after {
        content: attr(data-title);
      }
    }

    &.code_block { 
      @include details-code-variant($yellow); 
      
      &.success { @include details-code-variant($green); }
      &.info { @include details-code-variant($blue); }
      &.warning { @include details-code-variant($yellow); }
      &.error { @include details-code-variant($red); }

      &.example { @include details-code-variant($green); }
      &.exploit { @include details-code-variant($blue); }
    }
  }

  .success-block {
    padding: map-get($spacers, 2) map-get($spacers, 3);
    margin: map-get($spacers, 3) 0;
    background-color: rgba($green, .1);
    border-left: 4px solid $green;
    border-radius: map-get($base, border-radius);

    .block-title {
      font-weight: map-get($base, font-weight-bold);
      margin-bottom: map-get($spacers, 1);
    }
  }

  .info-block {
    padding: map-get($spacers, 2) map-get($spacers, 3);
    margin: map-get($spacers, 3) 0;
    background-color: rgba($blue, .1);
    border-left: 4px solid $blue;
    border-radius: map-get($base, border-radius);

    .block-title {
      font-weight: map-get($base, font-weight-bold);
      margin-bottom: map-get($spacers, 1);
    }
  }

  .warning-block {
    padding: map-get($spacers, 2) map-get($spacers, 3);
    margin: map-get($spacers, 3) 0;
    background-color: rgba($yellow, .1);
    border-left: 4px solid $yellow;
    border-radius: map-get($base, border-radius);

    .block-title {
      font-weight: map-get($base, font-weight-bold);
      margin-bottom: map-get($spacers, 1);
    }
  }

  .error-block {
    padding: map-get($spacers, 2) map-get($spacers, 3);
    margin: map-get($spacers, 3) 0;
    background-color: rgba($red, .1);
    border-left: 4px solid $red;
    border-radius: map-get($base, border-radius);

    .block-title {
      font-weight: map-get($base, font-weight-bold);
      margin-bottom: map-get($spacers, 1);
    }
  }

  .neutral-block {
    padding: map-get($spacers, 2) map-get($spacers, 3);
    margin: map-get($spacers, 3) 0;
    background-color: rgba($text-color, .05);
    border-left: 4px solid $text-color;
    border-radius: map-get($base, border-radius);

    .block-title {
      font-weight: map-get($base, font-weight-bold);
      margin-bottom: map-get($spacers, 1);
    }
  }

  // Predefined blocks: Proof, Remark, Note, Theorem, Proposition, Lemma
  // Usage: <div class="proof" markdown="1">...</div>
  // Inline title: <div class="proof inline" markdown="1">...</div>
  // Custom title: <div class="proof" data-title="My Proof" markdown="1">...</div>

  @mixin block-variant($name, $en-title, $zh-title, $parent-class) {
    @extend .#{$parent-class};
    
    &::before {
      content: $en-title;
      font-weight: map-get($base, font-weight-bold);
      display: block;
      margin-bottom: map-get($spacers, 1);
    }

    &:lang(zh)::before {
      content: $zh-title;
    }

    &[data-title]::before {
      content: $en-title " (" attr(data-title) ")";
    }

    &:lang(zh)[data-title]::before {
      content: $zh-title " (" attr(data-title) ")";
    }

    &.inline {
      &::before {
        content: $en-title ".";
        display: inline;
        float: left;
        margin-right: map-get($spacers, 2);
        margin-bottom: 0;
      }

      &:lang(zh)::before {
        content: $zh-title ".";
      }

      &[data-title]::before {
        content: $en-title " (" attr(data-title) ").";
      }

      &:lang(zh)[data-title]::before {
        content: $zh-title " (" attr(data-title) ").";
      }

      & > :first-child {
        margin-top: 0;
      }
    }
  }

  .proof:not(details) {
    @include block-variant("proof", "Proof", "证明", "warning-block");
  }

  .remark:not(details) {
    @include block-variant("remark", "Remark", "注记", "success-block");
  }

  .note:not(details) {
    @include block-variant("note", "Note", "注意", "info-block");
  }

  .theorem:not(details) {
    @include block-variant("theorem", "Theorem", "定理", "error-block");
  }

  .proposition:not(details) {
    @include block-variant("proposition", "Proposition", "命题", "info-block");
  }

  .lemma:not(details) {
    @include block-variant("lemma", "Lemma", "引理", "info-block");
  }

  .definition:not(details) {
    @include block-variant("definition", "Definition", "定义", "info-block");
  }

  .example:not(details) {
    @include block-variant("example", "Example", "示例", "success-block");
  }

  .solution:not(details) {
    @include block-variant("solution", "Solution", "解答", "warning-block");
  }

  @mixin code-block-variant($parent-class) {
    @extend .#{$parent-class};
    
    // 默认不显示标题前缀
    &::before {
      content: none;
      display: none;
    }

    // 只有当有 data-title 时才显示标题
    &[data-title]::before {
      content: attr(data-title);
      font-weight: map-get($base, font-weight-bold);
      display: block;
      margin-bottom: map-get($spacers, 1);
    }

    & > :first-child {
      margin-top: 0;
    }
  }

  .plain:not(details) {
    @include code-block-variant("neutral-block");

    &.success { @include code-block-variant("success-block"); }
    &.info { @include code-block-variant("info-block"); }
    &.warning { @include code-block-variant("warning-block"); }
    &.error { @include code-block-variant("error-block"); }
  }

  .code_block:not(details) {
    @include code-block-variant("warning-block");

    &.success { @include code-block-variant("success-block"); }
    &.info { @include code-block-variant("info-block"); }
    &.warning { @include code-block-variant("warning-block"); }
    &.error { @include code-block-variant("error-block"); }
    
    &.example { @include code-block-variant("success-block"); }
    &.exploit { @include code-block-variant("info-block"); }
  }
}

// Copy Code Button
.highlighter-rouge {
  position: relative;

  &:hover .copy-code-button {
    opacity: 1;
  }
}

.copy-code-button {
  position: absolute;
  top: .5rem;
  right: .5rem;
  padding: .25rem .5rem;
  font-size: .75rem;
  color: $text-color-3;
  background-color: $main-color-3;
  border: 1px solid $border-color;
  border-radius: 4px;
  cursor: pointer;
  opacity: 0;
  transition: opacity .2s ease-in-out, background-color .2s;
  z-index: 10;

  &:hover {
    background-color: darken($main-color-3, 5%);
  }

  &.copied {
    background-color: $green;
    color: #fff;
    border-color: $green;
  }
}

/* Images Figure Styles */
.image-figure {
  display: block;
  margin: 2rem auto;
  text-align: center;

  img {
    display: inline-block;
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transition: transform 0.3s ease, box-shadow 0.3s ease;

    &:hover {
      transform: scale(1.01);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
  }

  figcaption {
    margin-top: 0.75rem;
    color: #666;
    font-size: 0.9em;
    font-style: italic;
  }
}

/* Video Figure Styles */
.video-figure {
  display: block;
  margin: 2rem auto;
  text-align: center;

  video {
    display: inline-block;
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    background-color: #000; /* Video placeholder background */
  }

  figcaption {
    margin-top: 0.75rem;
    color: #666;
    font-size: 0.9em;
    font-style: italic;
  }
}

/* end custom scss snippet */

/* Artistic Blockquote Style */
.article__content blockquote:not(.simple) {
  position: relative;
  margin: 2rem 0;
  padding: 1.5rem 1.5rem 1.5rem 3.5rem;
  color: #555;
  background-color: #f8f9fa;
  border-left: 4px solid #e1e4e8;
  border-radius: 6px;
  font-family: "Georgia", "Times New Roman", Times, serif;
  font-size: 1.1em;
  font-style: italic;
  line-height: 1.8;
  
  /* Decorative Quote Icon */
  &::before {
    content: "\201C";
    position: absolute;
    top: 0.2rem;
    left: 1rem;
    font-size: 4rem;
    color: rgba(150, 150, 150, 0.25);
    font-family: Times, serif;
    font-weight: 900;
    line-height: 1;
  }

  p {
    margin: 0;
  }
  
  /* Support for citations within blockquote */
  footer, cite {
    display: block;
    text-align: right;
    font-size: 0.85em;
    font-style: normal;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    color: #888;
    margin-top: 0.5rem;
    
    &::before {
      content: "\2014 \00A0";
    }
  }
}
